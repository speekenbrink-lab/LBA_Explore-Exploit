#Simulate Sudden Uncertainty Onset
BanditSim <- function(params = c(3, 10, .2, 1, .5, 25, 3, 20), trialNum = 500) {
  
  rm('params')
  
  if (!exists('params')) {
    params <- c(10, 10, .2, 1, .5, 25, 5, 20, 3)
  }
  
  if (!exists('trialNum')) {
    trialNum = 200
  }
  
  require('tidyverse')
  
  source('RW.R', TRUE)
  source('LBASim.R', TRUE)
  source('runBanditSimple.R', TRUE)
  source('runBandit_TwoLBA.R', TRUE)
  
  #Set parameters (all in caps)
  #Start-point bound
  A <- params[1]
  #Threshold
  B <- params[2]
  #Decision Delay
  T0 <- params[3]
  #Standard Deviation
  SD_V <- params[4]
  #Learning Rate
  ALPHA <- params[5]
  #Starting values
  QSTART <- params[6]
  #Rate transformation from scores (Similar to a temperature parameter)
  PHI <- params[7]
  #Starting values for uncertainty
  UNCSTART <- params[8]
  #Weighting parameter for uncertainty
  GAMMA <- params[9]
  
  
  #Number of simulations
  simNum = 200
  
  #Optimality tracker
  simList <- matrix(ncol = simNum, nrow = trialNum)
  exploitList <- matrix(ncol = simNum, nrow = trialNum)
  tradExploitList <- matrix(ncol = simNum, nrow = trialNum)
  exploreList <- matrix(ncol = simNum, nrow = trialNum)
  
  # for (p in 1:simNum) {
  #   sim <- runBanditSimple(A, B, T0, SD_V, ALPHA, PHI, QSTART, trialNum)
  #   simList[1:trialNum, p] <- sim$optimal
  #   exploitList[1:trialNum, p] <- sim$exploit
  # }
  
  for (p in 1:simNum) {
    sim <- runBandit_TwoLBA(A, B, T0, SD_V, ALPHA, PHI, QSTART, UNCSTART, GAMMA, trialNum, 1)
    simList[1:trialNum, p] <- sim$optimal
    tradExploitList[1:trialNum, p] <- sim$traditionalExploit
  }
  
  condensedList <- apply(simList, 1, mean)
  tradExploitList <- apply(tradExploitList, 1, mean)
  
  condensedList <- data.frame(trial = 1:trialNum, averageScore = condensedList)
  exploitList <- data.frame(trial = 1:trialNum, averageExploit = tradExploitList)
  
  ggplot(data = condensedList, mapping = aes(x = trial, y = averageScore, group = 1)) +
    geom_line() +
    coord_cartesian(ylim = c(.3, 1))
  
  ggplot(data = exploitList, mapping = aes(x = trial, y = averageExploit, group = 1)) +
    geom_line() +
    coord_cartesian(ylim = c(.3, 1))
  
  return(condensedList)
}
