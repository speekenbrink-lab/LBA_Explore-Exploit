#Function to fit data from Uncertainty experiment
library('tidyverse')
library("R.matlab")
library('stats4')

source('LBAFit.R', local = TRUE)
source('LBApdf.R', TRUE)
source('LBAcdf.R', TRUE)
source('RW.R', TRUE)
source('readData.R', TRUE)
source('CMABFit.R', TRUE)
source('runPart.R', TRUE)
source('LBASim.R', TRUE)
source('CMABSim.R', TRUE)

cond = 1
pStart = 2
pNum = 2
trialNum = 448
secOneTrialNum = 256 
secTwoTrialNum = 192

params <- matrix(ncol = 7, nrow = pNum)
NLLs <- rep(0, nrom = pNum)
for (p in pStart:pNum) {
  rawData <- readData(trialNum, secOneTrialNum, secTwoTrialNum, cond, p)
  # rawData <- data.matrix(rawData)
  
  # startPoint = c(.5, 3, .3, 1, .4, .1, 1)
  
  # mle(CMABFit(params = startPoint, rawData = rawData), start = list(params = startPoint), fixed = list('rawData'))
  # param <- optim(c(.5, 3, .3, 1, .4, .1, 1),fn = CMABFit, rawData = rawData, lower = c(0, .5, 0, .01, .05, 0, 1), 
  #                upper = c(10, 10, 10, 5, 1, 30, 10))
  param <- optim(c(5, 5, 5, 5, .525, 15, 5),fn = CMABFit2, rawData = rawData)
  params[p,] <- param$par
  NLLs[p] <- param$value
  
  CMABSim(params[p,])
}

