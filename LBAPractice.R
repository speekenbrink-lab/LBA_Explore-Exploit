#RT Decision model
LBA <- function(n, A, B, t0, mean_v, SD_V) {#Simulate LBA model
  #n = number of participants
  #A = Starting point upper bound
  #b = threshold
  #t0 = start delay
  #mean_v = mean driftrate for each option
  #sd_v = mean standard deviation for each option
  
  #Simulate some trials
  
  choice <- 0
  rts <- 0
  driftLeft <- 0
  driftRight <- 0
  timeLeft <- 0
  timeRight <- 0
  
  for (t in 1:n) {
    trialFine <- 0
    while (!trialFine) {
      #Get Start point
      start <- runif(1, 0, A)
      drift <- 0
      time <- 0
      
      for (m in 1:2) {
      #Get Drift Rates
        drift[m] <- rnorm(1, mean_v[m], SD_V[m])
        
        #Get time to threshold
        time[m] <- (B - start) / drift[m]
        
        #Add non-decision time
        time[m] = time[m] + T0
      }
      
      #Check we don't have negative times
      if (time[1] > 0 & time[2] > 0) {
        trialFine = 1
      }
    }
    
    choice[t] <- which.min(time)
    rts[t] <- min(time)
    driftLeft[t] <- drift[1]
    driftRight[t] <- drift[2]
    timeLeft[t] <- time[1]
    timeRight[t] <- time[2]
  }
  
  sim <- data.frame(trial = seq(1, n), choice, rts, driftLeft, driftRight)
  
  simTime1 <- data.frame(trial = sim$trial, time = timeLeft, side = "LEFT")
  simTime2 <- data.frame(trial = sim$trial, time = timeRight, side = 'RIGHT')
  simTime <- merge(simTime1, simTime2, all = TRUE)
  simTime <-arrange(simTime, side)
  
  ggplot(data = simTime, mapping = aes(x = time, fill = side)) +
    geom_histogram(binwidth =1) +
    coord_cartesian(xlim = c(0, 10))
  
  return(sim)
}

