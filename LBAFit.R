#RT Decision model LBA using probability distributions for fitting
LBAFit <- function(A, B, T0, MEAN_V, SD_V, choiceNum, t, evalNum) {#Simulate LBA model
  #n = number of participants
  #A = Starting point upper bound
  #b = threshold
  #t0 = start delay
  #mean_v = mean driftrate for each option
  #SD_V = standard deviation of the driftrate
  #t = time at which the function is evaluated
  #evalNum = which choice is being evaluated on this trial

  #Calculate liklihood for each option using Defective PDFs
  
  CDF <- matrix(ncol = length(t), nrow = choiceNum)
  PDF <- matrix(ncol = length(t), nrow = choiceNum)
  
  #Calculate CDF and PDF for each option
  for (i in 1:choiceNum){
    CDF[i, 1:length(t)] <- LBAcdf(A, B, t, MEAN_V[i], SD_V[i])
    PDF[i, 1:length(t)] <- LBApdf(A, B, t, MEAN_V[i], SD_V[i])
  }

  likelihood <- matrix(ncol = length(t), nrow = choiceNum)
  for (i in 1:choiceNum){
    
    likelihood[i,1:length(t)] <- PDF[i,1:length(t)] * (1-CDF[3-i,1:length(t)])  
  }
  
  #Normalise probabilities to 1
  holder <- 0
  driftDist <- rep(0, times = choiceNum)
  for (i in 1:choiceNum) {
    holder <- integrate(dnorm, lower = -Inf, upper = 0, mean = MEAN_V[i], sd = SD_V[i])
    driftDist[i] <- array(as.numeric(unlist(holder[1])))
  }
  
  numerator <- prod(driftDist)
  
  likelihood <- likelihood / (1-numerator)
  
  return(likelihood[evalNum,])
}
